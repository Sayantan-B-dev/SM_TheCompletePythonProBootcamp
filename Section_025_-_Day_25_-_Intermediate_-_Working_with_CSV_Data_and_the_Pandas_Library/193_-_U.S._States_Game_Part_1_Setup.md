## STEP 1 — MAP & SCREEN SYSTEM ( `map_manager.py` )

> Scope of this step
> Only **visual layer**, **screen lifecycle**, **user input UI**, and **state rendering**
> No game rules, no pandas, no data logic

---

## Purpose of `MapManager`

`MapManager` is a **UI abstraction layer** built on top of `turtle`.
It isolates **all graphical responsibilities** so that:

* `main.py` controls flow
* `DataManager` controls data
* `MapManager` controls **how things look and how the user interacts**

This separation prevents **logic–UI coupling**, which is a professional design choice.

---

## File Responsibility Boundary

| File              | Responsibility                                      |
| ----------------- | --------------------------------------------------- |
| `map_manager.py`  | Screen setup, map display, user input, writing text |
| `data_manager.py` | CSV reading, validation, lookups                    |
| `main.py`         | Game loop & orchestration                           |

---

## Class Overview

```python
class MapManager:
```

This class encapsulates:

* `turtle.Screen`
* Background map image
* Input dialog
* Writing text at coordinates
* Graceful exit

No external file should touch `turtle` directly.

---

## `__init__` — Screen & Map Initialization

```python
def __init__(self, image, width, height, title):
```

### Parameters Explained

| Parameter | Purpose                    |
| --------- | -------------------------- |
| `image`   | Background map image (GIF) |
| `width`   | Screen width               |
| `height`  | Screen height              |
| `title`   | Window title               |

This allows **configuration without editing class code**.

---

### Screen Creation

```python
self.screen = t.Screen()
self.screen.title(title)
```

* Creates the global turtle screen
* Sets OS-level window title
* Required before any turtle rendering

---

### Registering Custom Shape (Critical)

```python
self.screen.addshape(image)
```

Why this is required:

* Turtle only understands registered shapes
* GIF images must be registered **before** usage
* Prevents runtime shape errors

---

### Screen Geometry Setup

```python
self.screen.setup(width=width, height=height)
```

* Controls pixel dimensions
* Must match image aspect ratio
* Prevents stretching or clipping

---

## Map Turtle — Background Renderer

```python
self.map_turtle = t.Turtle(shape=image)
self.map_turtle.penup()
```

### Why a Dedicated Turtle?

* This turtle **never moves**
* Only displays the map image
* Pen is lifted to avoid accidental drawing

This turtle acts as a **static canvas**, not an actor.

---

## Writer Turtle — Text Renderer

```python
self.writer = t.Turtle()
self.writer.hideturtle()
self.writer.penup()
```

### Why Separate Turtle for Writing?

| Reason                 | Explanation             |
| ---------------------- | ----------------------- |
| Separation of concerns | Background vs text      |
| Performance            | No redraw conflicts     |
| Control                | Independent positioning |

This turtle:

* Moves to coordinates
* Writes state names
* Never shows its shape

---

## `ask_state` — User Input Interface

```python
def ask_state(self, score, total):
```

### Purpose

* Displays input dialog
* Shows live progress
* Returns raw user input

---

### Dialog Implementation

```python
return self.screen.textinput(
    title=f"{score}/{total} Guess the State",
    prompt="Type a state name or 'Exit'"
)
```

### Behavior Notes

| Behavior           | Result         |
| ------------------ | -------------- |
| User types text    | Returns string |
| User clicks Cancel | Returns `None` |
| Dialog blocks      | Game pauses    |

This method is **pure UI**, no validation here.

---

## `write_state` — Rendering State Names

```python
def write_state(self, name, x, y):
```

### Responsibility

* Position text
* Write state label
* Do not alter game state

---

### Implementation

```python
self.writer.goto(x, y)
self.writer.write(
    name,
    align="center",
    font=("Arial", 8, "normal")
)
```

### Design Choices Explained

| Choice           | Reason                      |
| ---------------- | --------------------------- |
| `align="center"` | Text centered on coordinate |
| Small font       | Prevents overlap            |
| `goto(x, y)`     | Uses data-driven positions  |

Coordinates are **data-controlled**, not hardcoded.

---

## `close_on_click` — Graceful Exit

```python
def close_on_click(self):
    self.screen.exitonclick()
```

### Why This Exists

* Prevents window closing instantly
* Gives user control over exit
* Ensures program ends cleanly

This method marks the **end of UI lifecycle**.

---

## Map System Lifecycle (Sequence)

```
Screen created
   ↓
Map image registered
   ↓
Map turtle displayed
   ↓
Writer turtle ready
   ↓
Input dialog appears repeatedly
   ↓
State names written
   ↓
Exit on click
```

---

## Key Design Strengths (UI Layer)

| Aspect          | Quality                 |
| --------------- | ----------------------- |
| Encapsulation   | turtle hidden from main |
| Reusability     | Can swap map image      |
| Safety          | No UI logic leaks       |
| Maintainability | Clear responsibility    |

---

## What Is *Not* Done Here (By Design)

* No CSV access
* No state validation
* No scoring logic
* No missing-state logic

This is intentional and correct.

---

## Boundary Guarantee

If tomorrow you:

* Replace turtle with pygame
* Change map image
* Change font or size

You only touch `map_manager.py`.

---
